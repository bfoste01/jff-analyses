---
title: "03_Analyses"
author: "Brandon Foster, Ph.D."
date: "`r format(Sys.time(), '%d %B, %Y, %H:%M')`"
output:
  html_document:
    df_print: paged
    toc: yes
    theme: paper
  html_notebook:
    number_sections: yes
    toc: yes
---
# Initial 

Load in the tidy data for analyses.  
```{r, messages=FALSE, warning=FALSE, tidy=TRUE}
# Initialize an empty list to store the results ----
results <- list()

# Load the tidy data ----
readRDS("../data/efa.tidy.rds") -> efa.data

# Load packages ----
pacman::p_load(MplusAutomation)

# Specific transformations ----

# Models ----

# Tables ----

# Plots ----
```


# Exploratory Factor Analysis

The following code will run an EFA analyses of the item level data in MPlus. R interfaces with MPlus via the 'MplusAutomation' package. As such, the code to execute the exploratory factor analyses is written in MPlus notation. The code that follows will examine the potential for up to 6 factors. The rotation utilized assumes that factors are correlated. 

```{r, warning=FALSE, message=FALSE, echo=TRUE, tidy=TRUE}
# MPlus code for the EFA models ----
efa.1.6.code <- mplusObject(
  TITLE = "Title: JFF LCA 2017 EFA Up to 6 Factors;",
  ANALYSIS= 
  "TYPE =  EFA 1 6;",
  VARIABLE = "
  Missing are all (-99, -9, -8, -1);
  IDVARIABLE is id;
  ! removed givlecturR;
  !Categorical = progcompR;
  !mastercompR;
  !nextcompR;
  !samecompR;
  !futureR;
  !shareexampR;
  !gradeworkR;
  !rubricR;",
  usevariables = c("id", "mastercompR", "nextcompR", "rubricR", "onlinecompR", "projcredR", "interncredR",
  "smallgrpR", "teachdifR", "choosehowR", "retakeR", "demolearnR", "adviceR", "trackprogR", "ontimeR", "prepgradR"),
  rdata = efa.data)

# Execute the Mplus code ----
efa.1.6.results <- mplusModeler(efa.1.6.code,
  dataout = c("../mplus/03_Analyses.dat"),                       
  modelout = c("../mplus/03_Analyses.inp"), run=TRUE)

# Munge the MPlus Output ----

# extract model summaries
efa_summaryStats <- extractModelSummaries("../mplus/03_Analyses.out")

# pull out model relevant fit statisics
efa_fitstats.table <- dplyr::select(efa_summaryStats, NumFactors, BIC, aBIC, AIC, AICC, CFI, TLI, SRMR, RMSEA_Estimate, RMSEA_90CI_LB, RMSEA_90CI_UB) %>%
  dplyr::rename("Number of Factors" = NumFactors, "Lower 95% RMSEA" = RMSEA_90CI_LB, "Upper 95% RMSEA" = RMSEA_90CI_UB) %>%
  dplyr::arrange(BIC)

# Save the Results of Interest to List ----

# add to the list of results 
results <- list(efa.1.6.results, efa_fitstats.table)
```

```{r, messages=FALSE, warning=FALSE}
# Save the results object ----
saveRDS(results, file = "data/results.rds")
```